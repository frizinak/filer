<?php
define('FILER_CRON', 'filer:');

/**
 * Implements hook_cron_queue_info().
 */
function filer_cron_queue_info() {
  $queues = array();
  foreach (Filer::getNames() as $id) {
    $queues[FILER_CRON . $id] = array(
      'worker callback' => 'filer_cron_callback',
      'time' => 30,
    );
  }
  return $queues;
}

/**
 * Main cron callback.
 */
function filer_cron_callback($data) {
  // Ignore invalid queue items.
  foreach (array('name', 'frid', 'item', 'append', 'read', 'status') as $key) {
    if (!isset($data[$key])) {
      watchdog('filer', 'data passed to filer_cron_callback is incomplete.', $data);
      return;
    }
  }
  //
  $filer = new Filer($data['name']);
  $filer->_run($data['frid'], $data['item'], $data['append'], $data['read'], $data['status']);
}
